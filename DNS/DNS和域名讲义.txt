DNS(Domain Name System)
域名系统
因特网上作为域名和IP地址互相映射的一个分布式数据库，能够使用户更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。通过主机名，最终得到该主机对应的IP地址的过程叫做域名解析（或主机名解析）。DNS协议运行在UDP协议之上，使用端口号53。
DNS的分布数据库是以域名为索引的，每个域名实际上就是一棵很大的逆向树中路径，这棵逆向树称为域名空间（domain name space），如下图所示树的最大深度不得超过127层，树中每个节点都有一个可以长达63个字符的文本标号。
讲义：
 
一、引言
 
在当今数字化的时代，互联网已经成为我们生活和工作中不可或缺的一部分。而 DNS（域名系统）和域名作为互联网的重要组成部分，对于我们顺利访问各种网站和应用程序起着关键作用。
 
1. 解释 DNS 和域名的重要性：
DNS 是互联网的电话簿，它将我们熟悉的域名转换为计算机可以理解的 IP 地址，使得我们能够轻松地通过输入域名来访问对应的网站或服务。域名则是我们在互联网上的身份标识，它代表着我们的个人或组织在数字世界中的存在。
2. 简要介绍网络安全的背景和意义：
随着互联网的普及和信息技术的快速发展，网络安全威胁也日益增加。DNS 和域名系统的安全直接关系到我们的个人信息安全、企业的正常运营以及整个互联网的稳定运行。
 
通过本讲义的学习，我们将深入了解 DNS 和域名的工作原理，以及它们在网络安全中所面临的挑战和应对措施。这将帮助我们更好地保护自己在互联网上的权益，同时也为构建更加安全可靠的网络环境贡献一份力量。
 
在接下来的课程中，我们将逐步探讨 DNS 和域名的相关概念、安全威胁、防范措施等内容，并通过案例分析和实际应用加深对这些知识的理解和掌握。希望同学们能够积极参与讨论，提出问题，共同探索网络世界的奥秘。
 
二、DNS 概述
 
1. DNS 的定义和作用：
DNS（Domain Name System）即域名系统，是互联网的一项服务。它作为一个分布式数据库，将域名和 IP 地址相互映射，使得用户能够通过输入域名来访问相应的网站或服务。DNS 的主要作用是将域名解析为对应的 IP 地址，从而实现互联网的通信和访问。
2. 域名的概念和结构：
域名（Domain Name）是互联网上的标识符，用于唯一标识一个组织、个人或计算机在网络中的位置。它由一系列字符组成，通常遵循特定的命名规则，例如由字母、数字和特定字符（如点号、横线等）组成。域名结构包括顶级域名（TLD）、二级域名、三级域名等，例如"example.com"，其中"com"是顶级域名，"example"是二级域名。
3. DNS 解析的过程和原理：
当用户在浏览器中输入一个域名时，浏览器会向 DNS 服务器发送请求，请求将该域名解析为对应的 IP 地址。DNS 服务器会查询其数据库，找到与该域名对应的 IP 地址，并将其返回给浏览器。浏览器接收到 IP 地址后，就可以与该服务器建立连接，访问相应的网站或服务。这个过程被称为 DNS 解析。
 
在 DNS 解析过程中，涉及到多个层次的 DNS 服务器。根 DNS 服务器负责存储顶级域名的信息，如.com、.org 等。顶级域名服务器负责存储各个国家或地区的域名信息，如.cn、.uk 等。而权威 DNS 服务器则负责存储特定域名的解析信息。当 DNS 服务器无法找到对应域名的解析信息时，它会向上级 DNS 服务器递归查询，直到找到为止。

三、DNS 安全威胁
 
1. DNS 劫持：
DNS 劫持是指攻击者通过篡改 DNS 服务器的记录，将用户的请求导向恶意网站或服务器。这可能导致用户被重定向到钓鱼网站、恶意软件下载页面等，从而造成信息泄露或系统感染恶意软件。DNS 劫持可以通过网络攻击、恶意软件感染等方式实现。
2. DNS 欺骗：
DNS 欺骗是指攻击者通过伪造 DNS 响应，将用户的请求导向虚假的 IP 地址。这可能导致用户无法访问正常的网站，或者被导向攻击者控制的恶意网站。DNS 欺骗通常与网络攻击、恶意软件等相关。
3. DNS 缓存污染：
DNS 缓存污染是指攻击者通过篡改 DNS 缓存中的记录，将用户的请求导向恶意网站或服务器。这可能导致用户在一段时间内无法访问正常的网站，或者被导向攻击者控制的恶意网站。DNS 缓存污染通常发生在 DNS 服务器或用户的计算机上。
4. 域名抢注：
域名抢注是指攻击者通过抢注与知名品牌、公司或个人相关的域名，以获取非法利益。这可能导致品牌形象受损、用户流量流失等问题。
5. 域名劫持：
域名劫持是指攻击者通过控制域名的解析过程，将用户的请求导向恶意网站或服务器。这可能导致用户无法访问正常的网站，或者被导向攻击者控制的恶意网站。域名劫持通常与网络攻击、恶意软件等相关。
 
以上是 DNS 安全威胁的主要类型，这些威胁可能导致用户信息泄露、网络中断、品牌形象受损等问题。因此，保护 DNS 安全对于确保网络的正常运行和用户的信息安全至关重要。
四、DNS 安全防范措施
 
1. 使用可靠的 DNS 服务器：
选择可信任的 DNS 服务提供商，确保其具备良好的安全性和可靠性。避免使用免费的 DNS 服务，因为它们可能存在安全风险。推荐使用由互联网服务提供商（ISP）或专业的 DNS 提供商提供的服务。
2. 监测 DNS 流量和异常：
使用网络监测工具，对 DNS 流量进行实时监测，以发现异常活动。这可以帮助识别潜在的 DNS 劫持或其他攻击行为。定期检查 DNS 日志，以发现异常的请求或响应。
3. 实施 DNSSEC 增强安全性：
DNSSEC（Domain Name System Security Extensions）是一种增强 DNS 安全性的协议。它通过引入数字签名，确保 DNS 数据的完整性和真实性。DNSSEC 可以防止 DNS 劫持、欺骗和缓存污染等攻击。确保你的 DNS 服务器支持并启用 DNSSEC。
4. 定期检查 DNS 设置：
定期检查 DNS 服务器的配置，确保其正确运行。检查是否存在不必要的开放端口、异常的服务或未授权的修改。及时更新 DNS 服务器的软件和固件，以修复已知的漏洞。
5. 加强网络安全整体措施：
除了针对 DNS 采取特定的安全措施，还应加强网络安全的整体措施。这包括使用防火墙、入侵检测系统、防病毒软件等安全工具，以及定期进行网络安全审计和漏洞扫描。
6. 提高用户意识和教育：
教育用户有关 DNS 安全威胁和最佳实践，以提高他们的安全意识。鼓励用户避免使用不可信的网络连接，避免点击可疑的链接，以及定期检查计算机的安全状态。
 
五、DNS 和域名安全的实际应用
 
1. 网站和网络服务的配置：
在搭建网站或提供网络服务时，正确配置 DNS 是确保用户能够正常访问的关键。学生应该了解如何将域名与服务器的 IP 地址进行关联，以及如何设置 DNS 记录，如 A 记录、CNAME 记录等。
2. 检测和防范 DNS 攻击：
介绍一些常见的 DNS 攻击检测工具和技术，如 DNS 监测软件、日志分析等。学生可以学习如何识别 DNS 攻击的迹象，并采取相应的防范措施，如配置 DNS 防火墙、更新 DNS 服务器等。
3. DNSSEC 的应用：
深入讲解 DNSSEC 的工作原理和应用场景。学生可以了解如何通过 DNSSEC 确保 DNS 数据的真实性和完整性，以及如何验证 DNS 响应的签名。
4. 案例分析与讨论：
通过实际案例分析，让学生讨论 DNS 安全问题的影响和解决方案。例如，分析一起 DNS 劫持事件，探讨可能的攻击手段和防范措施。
5. 实践操作与实验：
安排实践操作环节，让学生亲身体验 DNS 的设置和管理。例如，让学生在实验环境中配置 DNS 服务器，观察 DNS 解析的过程，并进行一些安全测试。
 
通过这部分讲义，学生可以将理论知识应用到实际场景中，加深对 DNS 和域名安全的理解，并培养解决实际问题的能力。在讲解过程中，可以结合实例和实际操作，让学生更加直观地了解 DNS 和域名安全的重要性和实际应用。
 
 
六、DNS 和域名的未来发展趋势
 
1. DNS 技术的演进：
探讨 DNS 技术的发展方向，如 DNS over HTTPS（DoH）的出现，它提供了加密的 DNS 通信，增强了用户的隐私和安全性。此外，还可以讨论诸如 DNS 加密、DNS 缓存优化等技术的发展。
2. IPv6 对 DNS 的影响：
随着 IPv6 的广泛采用，DNS 也需要相应的支持和演进。讨论 IPv6 环境下的 DNS 协议变化、IPv6 地址的解析等相关问题。
3. 域名系统的扩展和创新：
介绍一些新兴的域名系统扩展，如新的顶级域名（TLD）的出现、个性化域名等。探讨这些扩展对互联网和业务的影响。
4. 人工智能与 DNS：
探讨人工智能技术在 DNS 中的应用可能性，如利用机器学习进行 DNS 流量分析、预测 DNS 故障等。
5. 物联网与 DNS：
随着物联网的快速发展，大量的设备连接到互联网，DNS 将在物联网环境中扮演重要角色。讨论物联网设备的 DNS 需求和挑战。
6. DNS 与网络安全的紧密结合：
强调 DNS 在网络安全中的关键地位，并探讨如何更好地结合 DNS 与其他安全技术，如 DDoS 防护、威胁情报等，以提高整体网络安全性。
 
这部分内容可以激发学生对 DNS 和域名未来发展的思考，并了解相关领域的最新趋势。在讲解过程中，可以引导学生进行讨论，分享他们对未来 DNS 和域名发展的看法和预测。
一、DNS是什么

DNS（Domain Names System），域名系统，是互联网一项服务，是进行域名和与之相对应的 IP 地址进行转换的服务器

简单来讲，DNS相当于一个翻译官，负责将域名翻译成ip地址

    IP 地址：一长串能够唯一地标记网络上的计算机的数字
    域名：是由一串用点分隔的名字组成的 Internet 上某一台计算机或计算机组的名称，用于在数据传输时对计算机的定位标识


二、域名

域名是一个具有层次的结构，从上到下一次为根域名、顶级域名、二级域名、三级域名…

例如www.xxx.com，www为三级域名、xxx为二级域名、com为顶级域名，系统为用户做了兼容，域名末尾的根域名.一般不需要输入

在域名的每一层都会有一个域名服务器，如下图：

除此之外，还有电脑默认的本地域名服务器
三、查询方式

DNS 查询的方式有两种：

    递归查询：如果 A 请求 B，那么 B 作为请求的接收者一定要给 A 想要的答案

    迭代查询：如果接收者 B 没有请求者 A 所需要的准确内容，接收者 B 将告诉请求者 A，如何去获得这个内容，但是自己并不去发出请求


四、域名缓存

在域名服务器解析的时候，使用缓存保存域名和IP地址的映射

计算机中DNS的记录也分成了两种缓存方式：

最近很多小伙伴找我要各种学习资料，但一个个私信太耽误大家时间了，于是我整理了一些优质经典学习资源，涵盖Linux、虚拟化、容器、云计算、网络、Python等书籍和视频，点击链接即可领取，祝学业有成！（无任何套路！）
10T学习资源大放送，涵盖Linux、虚拟化、容器、云计算、网络、Python、Go等书籍和视频​
vav3edpx5yq.feishu.cn/docx/BJkfdJ3gAoUKvrxvyHEcCyztn5d


    浏览器缓存：浏览器在获取网站域名的实际 IP 地址后会对其进行缓存，减少网络请求的损耗
    操作系统缓存：操作系统的缓存其实是用户自己配置的 hosts 文件（欢迎关注公众号：网络技术联盟圈）


五、查询过程

解析域名的过程如下：

    首先搜索浏览器的 DNS 缓存，缓存中维护一张域名与 IP 地址的对应表
    若没有命中，则继续搜索操作系统的 DNS 缓存
    若仍然没有命中，则操作系统将域名发送至本地域名服务器，本地域名服务器采用递归查询自己的 DNS 缓存，查找成功则返回结果
    若本地域名服务器的 DNS 缓存没有命中，则本地域名服务器向上级域名服务器进行迭代查询
        首先本地域名服务器向根域名服务器发起请求，根域名服务器返回顶级域名服务器的地址给本地服务器
        本地域名服务器拿到这个顶级域名服务器的地址后，就向其发起请求，获取权限域名服务器的地址
        本地域名服务器根据权限域名服务器的地址向其发起请求，最终得到该域名对应的 IP 地址
    本地域名服务器将得到的 IP 地址返回给操作系统，同时自己将 IP 地址缓存起来
    操作系统将 IP 地址返回给浏览器，同时自己也将 IP 地址缓存起
    至此，浏览器就得到了域名对应的 IP 地址，并将 IP 地址缓存起

流程如下图所示：

下面解析步骤进行讲解，后面将采用命令行的形式来跟踪解析过程。当用户在地址栏键入并敲下回车键之后，域名解析就开始了。

第一步：检查浏览器缓存中是否缓存过该域名对应的IP地址

用户通过浏览器浏览过某网站之后，浏览器就会自动缓存该网站域名对应的地址，当用户再次访问的时候，浏览器就会从缓存中查找该域名对应的IP地址，因为缓存不仅是有大小限制，而且还有时间限制（域名被缓存的时间通过属性来设置），所以存在域名对应的找不到的情况。当浏览器从缓存中找到了该网站域名对应的地址，那么整个解析过程结束，如果没有找到，将进行下一步骤。对于的缓存时间问题，不宜设置太长的缓存时间，时间太长，如果域名对应的发生变化，那么用户将在一段时间内无法正常访问到网站，如果太短，那么又造成频繁解析域名。

第二步：如果在浏览器缓存中没有找到IP，那么将继续查找本机系统是否缓存过IP

如果第一个步骤没有完成对域名的解析过程，那么浏览器会去系统缓存中查找系统是否缓存过这个域名对应的地址，也可以理解为系统自己也具备域名解析的基本能力。在系统中，可以通过设置文件来将域名手动绑定到某上，文件位置在。对于普通用户，并不推荐自己手动绑定域名和，对于开发者来说，通过绑定域名和，可以轻松切换环境，可以从测试环境切换到开发环境，方便开发和测试。在系统中，黑客常常修改他的电脑的文件，将用户常常访问的域名绑定到他指定的上，从而实现了本地解析，导致这些域名被劫持。在或者系统中，文件在，修改该文件也可以实现同样的目的。

前两步都是在本机上完成的，所以没有在上面示例图上展示出来，从第三步开始，才正在地向远程DNS服务器发起解析域名的请求。

第三步：向本地域名解析服务系统发起域名解析的请求

如果在本机上无法完成域名的解析，那么系统只能请求本地域名解析服务系统进行解析，本地域名系统一般都是本地区的域名服务器，比如你连接的校园网，那么域名解析系统就在你的校园机房里，如果你连接的是电信、移动或者联通的网络，那么本地域名解析服务器就在本地区，由各自的运营商来提供服务。对于本地服务器地址，系统使用命令就可以查看，在和系统下，直接使用命令来查看服务地址。一般都缓存了大部分的域名解析的结果，当然缓存时间也受域名失效时间控制，大部分的解析工作到这里就差不多已经结束了，负责了大部分的解析工作。

第四步：向根域名解析服务器发起域名解析请求

本地域名解析器还没有完成解析的话，那么本地域名解析服务器将向根域名服务器发起解析请求。（欢迎关注公众号：网络技术联盟圈）

第五步：根域名服务器返回gTLD域名解析服务器地址

本地域名解析向根域名服务器发起解析请求，根域名服务器返回的是所查域的通用顶级域（）地址，常见的通用顶级域有、、、等。

第六步：向gTLD服务器发起解析请求

本地域名解析服务器向gTLD服务器发起请求。

第七步：gTLD服务器接收请求并返回Name Server服务器

服务器接收本地域名服务器发起的请求，并根据需要解析的域名，找到该域名对应的域名服务器，通常情况下，这个服务器就是你注册的域名服务器，那么你注册的域名的服务商的服务器将承担起域名解析的任务。

第八步：Name Server服务器返回IP地址给本地服务器

服务器查找域名对应的地址，将地址连同值返回给本地域名服务器。

第九步：本地域名服务器缓存解析结果

本地域名服务器缓存解析后的结果，缓存时间由时间来控制。

第十步：返回解析结果给用户

解析结果将直接返回给用户，用户系统将缓存该地址，缓存时间由来控制，至此，解析过程结束。

这里对解析的步骤进行了一个简单的介绍分析，后面将通过命令行的形式来解析一个域名的具体解析过程。

二、 DNS域名解析过程分析

在正式开始分析解析过程之前，先来介绍几个基本的域名解析方式的概念。域名解析记录主要分为A记录、MX记录、CNAME记录、NS记录以及TXT记录。
DNS 资源记录

在 DNS 服务器上，一个域名及其下级域名组成一个区域。相关的 DNS 信息构成一个数据库文件。所以每个区域数据库文件都是由资源记录构成的，一个资源记录就是一行文本，提供了一组有用的 DNS 配置信息。

常见的资源记录类型如表所示。

A记录，A代表的是Address，用来指定域名对应的IP地址，如将http://xxxxx.com指定到IP地址139.***.184.***。A记录可以将多个域名解析到一个IP地址，但是不能将一个域名解析到多个IP地址。

A记录就是解析我们常见的带www和不带www的域名，解析不带www的域名时主机记录填@或者不填，解析带www的域名时主机记录填www。

MX记录，表示的是Mail Exchange，就是可以将某个域名下的邮件服务器指向自己的Mail Server，如http://xxxxx.com域名的A记录IP地址是115.***.25.***，如果MX记录设置为115.***.25.***，是xxx@xxxxxx.com的邮件路由，DNS会将邮件发送到***.238.25.***所在的服务器，而正常通过Web请求的话仍然解析到A记录的IP地址。

CNAME记录，全称是Canonical Name（别名解析）。所谓的别名解析就是可以为一个域名设置一个或者多个别名，别名解析通常用来解析二级域名。

NS记录，为某个域名指定DNS解析服务器，也就是这个域名有指定的IP地址的DNS服务器去解析。
TXT记录，为某个主机名或域名设置说明，如可以为http://maikeseo.com设置TXT记录为”麦可SEO”这样的说明。
上面概念中的地址都是假定的，帮助理解。下面将通过解析域名为例，进一步说明域名解析流程。

直接查看域名结果，可以通过命令加上域名来查看：



上图中表示解析结果来自非权威服务器，也就是说这个结果来自缓存，并没有完全经历全部的解析过程，从某个缓存中读取的结果，这个结果存在一定的隐患，比如域名对应的地址已经更变。

这只是一个快捷的解析结果，如果需要浏览全部的解析过程，那么可以使用命令来查看解析过程。

分析上图解析过程，我们可以看出：

第一步：从本地域名解析服务器获取到个根域名服务器对应的主机名。

第二步：从个根域名服务器中的其中一个（这里是）获取到顶级的服务器（未显示）和名称。

第三步：向域的一台服务器请求解析，它返回了域的服务器（未显示）和名称，百度有四台顶级域的服务器。

第四步：向百度的顶级域服务器请求，它发现这个有个别名，而不是一台主机，别名是http://www.a.shifen.com。

一般情况下，解析到别名就停止了，返回了具体的地址，如果想看到具体的地址，可以进一步对别名进行解析，解析结果如下：

这时候看到最后的解析结果是a.shifen.com.。在解析别名的过程中，可以发现和都是指定了相同的域名解析服务器。以上是一个域名的解析过程，最后的解析结果和一开始的使用的结果一致
